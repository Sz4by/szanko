<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Christmas Gamer Profile</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@400;700&family=Rajdhani:wght@400;600;700&display=swap');

        :root {
            --xmas-red: #d42426;
            --xmas-green: #146b3a;
            --xmas-gold: #f8b229;
            --snow: #ffffff;
            --dark-bg: #0f0505;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            overflow-x: hidden;
            background-color: var(--dark-bg);
            color: var(--snow);
        }

        /* Háttér Videó */
        #bg-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -2;
            opacity: 0.6; 
            filter: contrast(1.1) brightness(0.6); 
        }

        /* Karácsonyi Izzósor */
        .light-rope {
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            position: absolute;
            z-index: 1;
            margin: -15px 0 0 0;
            padding: 0;
            pointer-events: none;
            width: 100%;
        }

        .light-rope li {
            position: relative;
            animation-fill-mode: both; 
            animation-iteration-count: infinite;
            list-style: none;
            margin: 0;
            padding: 0;
            display: inline-block;
            width: 12px;
            height: 28px;
            border-radius: 50%;
            margin: 20px;
            background: #fff;
            box-shadow: 0px 5px 20px 2px #fff;
            animation-name: flash-1;
            animation-duration: 2s;
        }

        .light-rope li:nth-child(2n) { background: var(--xmas-green); box-shadow: 0px 5px 20px 2px var(--xmas-green); animation-name: flash-2; animation-duration: 0.4s; }
        .light-rope li:nth-child(4n) { background: var(--xmas-red); box-shadow: 0px 5px 20px 2px var(--xmas-red); animation-name: flash-3; animation-duration: 1.1s; }
        .light-rope li:nth-child(odd) { animation-duration: 1.8s; }

        @keyframes flash-1 { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes flash-2 { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes flash-3 { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* Fő Kártya Stílus */
        .glass-card {
            background: linear-gradient(135deg, rgba(60, 10, 10, 0.9), rgba(10, 40, 20, 0.9));
            backdrop-filter: blur(10px);
            border: 2px solid rgba(248, 178, 41, 0.3);
            box-shadow: 0 10px 30px rgba(0,0,0,0.8), inset 0 0 20px rgba(212, 36, 38, 0.2);
            border-radius: 24px;
            position: relative;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 10; /* Alap réteg */
        }

        .glass-card:hover {
            transform: translateY(-5px) scale(1.02);
            border-color: var(--xmas-gold);
            box-shadow: 0 20px 40px rgba(0,0,0,0.9), 0 0 20px rgba(248, 178, 41, 0.4);
        }

        /* Hósapka - JAVÍTVA */
        .glass-card::before {
            content: '';
            position: absolute;
            top: -8px; 
            left: -2px;
            right: -2px;
            height: 18px;
            background: url("https://www.transparenttextures.com/patterns/snow.png"), white;
            border-radius: 12px 12px 50% 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 15; 
            pointer-events: none;
        }

        /* Fontok */
        .font-christmas {
            font-family: 'Mountains of Christmas', cursive;
        }

        /* Mikulás Sapka */
        .santa-hat-overlay {
            position: absolute;
            top: -35px;
            right: -25px;
            font-size: 4rem;
            color: var(--xmas-red);
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.5));
            transform: rotate(15deg);
            z-index: 50;
            pointer-events: none;
            animation: hat-bounce 3s infinite ease-in-out;
        }

        @keyframes hat-bounce {
            0%, 100% { transform: rotate(15deg) translateY(0); }
            50% { transform: rotate(10deg) translateY(-5px); }
        }

        /* Discord Widget */
        .discord-bg {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Toast */
        #toast-notification {
            visibility: hidden;
            min-width: 300px;
            background: linear-gradient(to right, #146b3a, #0f3d22);
            color: #fff;
            border-radius: 50px;
            padding: 16px 24px;
            position: fixed;
            z-index: 2000;
            left: 50%;
            bottom: -100px;
            transform: translateX(-50%);
            box-shadow: 0 0 30px rgba(20, 107, 58, 0.6), 0 5px 15px rgba(0,0,0,0.5);
            border: 2px solid var(--xmas-gold);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        #toast-notification.show {
            visibility: visible;
            opacity: 1;
            bottom: 40px;
        }

        /* Zenelejátszó */
        .vinyl-spin {
            animation: spin-record 10s linear infinite;
        }
        .vinyl-paused {
            animation-play-state: paused;
        }
        @keyframes spin-record { 100% { transform: rotate(360deg); } }

        /* Social Icons */
        .social-orb {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2), rgba(0,0,0,0.8));
            background-color: #222;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5), inset 0 0 10px rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s;
            position: relative;
        }
        
        .social-orb::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 10px;
            background: #888;
            border-radius: 2px;
        }

        .social-orb:hover {
            transform: translateY(-5px) rotate(10deg);
            box-shadow: 0 0 20px var(--xmas-gold);
            background-color: var(--xmas-red);
        }

        /* Tiltások */
        body { user-select: none; -webkit-user-select: none; }
        img { pointer-events: none; -webkit-user-drag: none; }
        input, textarea { user-select: text; }

    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-between p-4 relative">

    <!-- Havas Háttér Videó -->
    <video autoplay muted loop playsinline id="bg-video">
        <source src="https://media.istockphoto.com/id/1745494320/ro/video/cr%C4%83ciun-alb-%C3%AEntr-o-p%C4%83dure-de-copaci-acoperi%C8%9Bi-de-z%C4%83pad%C4%83-alb%C4%83-%C8%99i-un-peisaj-de-iarn%C4%83-%C3%AEnz%C4%83pezit.mp4?p=1&s=mp4-640x640-is&k=20&c=xflSDA4HaFSBLqnE0PFM-EDjnuRXq3zH7y4TVEYQwVc=" type="video/mp4">
    </video>

    <!-- Izzósor -->
    <ul class="light-rope">
        <li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li>
        <li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li>
        <li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li>
    </ul>

    <header class="w-full max-w-6xl text-center py-12 relative z-10">
        <h1 class="font-christmas text-5xl md:text-7xl text-[#f8b229] drop-shadow-[0_0_15px_rgba(255,0,0,0.8)] transform -rotate-2">
            <i class="fas fa-holly-berry text-[#d42426] mr-3"></i>Boldog Karácsonyt!<i class="fas fa-holly-berry text-[#d42426] ml-3"></i>
        </h1>
    </header>

    <main class="w-full max-w-6xl grid grid-cols-1 lg:grid-cols-2 gap-10 z-10 mb-10">
        
        <!-- Fő Profil Kártya -->
        <div class="glass-card p-8 pt-10 flex flex-col items-center text-center">
            <!-- Dekorációk - JAVÍTOTT Z-INDEX (z-20) -->
            <div class="absolute -top-6 -left-6 text-5xl text-[#f8b229] drop-shadow-lg animate-pulse z-20"><i class="fas fa-star"></i></div>
            <div class="absolute -top-6 -right-6 text-5xl text-[#d42426] drop-shadow-lg transform rotate-12 z-20"><i class="fas fa-gift"></i></div>

            <h2 class="text-2xl font-bold mb-8 border-b border-white/20 pb-2 w-full flex items-center justify-center gap-2 text-[#a5f3fc]">
                <i class="fas fa-gamepad"></i> Captain's Quarters
            </h2>
            
            <!-- Profilkép + Mikulás Sapka -->
            <div class="relative mb-12 group cursor-pointer hover:scale-105 transition-transform duration-500">
                 <div class="w-48 h-48 rounded-full border-4 border-[#d42426] overflow-hidden shadow-[0_0_40px_rgba(212,36,38,0.6)] relative z-10 bg-black">
                     <img src="https://bunker-985980004.imgix.net/%3Fmask=ellipse" alt="Main Profile" class="w-full h-full object-cover">
                 </div>
                 <!-- Mikulás Sapka Ikon -->
                 <div class="santa-hat-overlay">
                    <i class="fas fa-hat-santa"></i>
                 </div>
                 
                 <div class="absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2 bg-[#146b3a] text-white text-sm font-bold px-4 py-1 rounded-full border-2 border-[#f8b229] z-20 shadow-lg whitespace-nowrap">
                    <i class="fas fa-tree mr-1 text-[#f8b229]"></i> LVL 99 ELF
                 </div>
            </div>

            <!-- Gömb Social Ikonok -->
            <div class="flex flex-wrap justify-center gap-6 mb-8 w-full relative z-30">
                <a href="#" class="social-orb"><i class="fab fa-discord"></i></a>
                <a href="#" class="social-orb"><i class="fab fa-instagram"></i></a>
                <a href="#" class="social-orb"><i class="fab fa-tiktok"></i></a>
                <a href="#" class="social-orb"><i class="fab fa-spotify"></i></a>
                <a href="#" class="social-orb"><i class="fab fa-youtube"></i></a>
            </div>

            <div class="bg-black/40 p-6 rounded-xl border border-white/10 w-full text-left backdrop-blur-sm">
                <h3 class="text-xl font-bold text-[#f8b229] mb-3 font-christmas tracking-wide">Szaby levele a Télapónak:</h3>
                <p class="text-lg leading-relaxed text-gray-200 italic">
                    "Üdvözlünk a téli bázisomon! A nevem <span class="text-[#d42426] font-bold">Szaby</span>. Két bejgli között streamelek és játszom. Célom a szórakoztatás és egy szuper közösség építése. Nézz be, kövess be, és találkozzunk a Discordon! <br><br>
                    <span class="font-bold text-[#146b3a]"><i class="fas fa-sleigh"></i> Kellemes Ünnepeket!</span>"
                </p>
            </div>
        </div>

        <!-- Jobb Oldali Oszlop -->
        <div class="flex flex-col gap-8">
            
            <!-- Discord Live Uplink -->
            <div class="glass-card p-6 pt-8 flex flex-col relative group h-fit">
                <!-- Hóréteg miatt a z-index itt is fontos lehet dekorációknál -->
                <div class="absolute top-0 right-0 p-4 opacity-30 group-hover:opacity-80 transition-opacity z-10">
                    <i class="fab fa-discord text-8xl text-white transform -rotate-12"></i>
                </div>
                <h2 class="text-2xl font-bold mb-6 border-b border-white/20 pb-2 flex items-center gap-2 text-[#a5f3fc] z-20 relative">
                    <i class="fas fa-satellite-dish text-[#146b3a]"></i> Északi-sark Kapcsolat
                </h2>
                
                <!-- Kattintható Discord Név -->
                <div id="discord-info-container" class="flex items-center gap-5 mb-6 cursor-pointer hover:bg-white/10 p-3 rounded-xl transition-all group/tooltip relative border border-transparent hover:border-white/20 z-20" title="Másoláshoz kattints!">
                    <div class="relative">
                        <div class="w-20 h-20 rounded-full border-2 border-[#5865F2] overflow-hidden shadow-lg bg-black">
                            <img id="discord-avatar" src="https://api.dicebear.com/9.x/avataaars/svg?seed=DiscordBot&backgroundColor=1e293b" alt="Discord Avatar" class="w-full h-full object-cover">
                        </div>
                        <div id="discord-status-indicator" class="absolute bottom-0 right-0 w-6 h-6 rounded-full border-4 border-[#2a0a0a] status-offline bg-gray-500 discord-status-dot z-20"></div>
                    </div>
                    <div class="flex flex-col z-10">
                        <h3 id="discord-username" class="text-3xl font-bold text-white tracking-wide font-christmas">Szaby</h3>
                        <p id="discord-discriminator" class="text-sm text-gray-400">#1234</p>
                        <p id="discord-status-text" class="text-[#f8b229] font-mono text-sm mt-1 font-bold uppercase">Loading...</p>
                        
                        <p class="text-[10px] text-[#146b3a] font-bold bg-[#f8b229] px-2 py-0.5 rounded text-black absolute -bottom-2 left-20 opacity-0 group-hover/tooltip:opacity-100 transition-opacity shadow-lg transform translate-y-2 group-hover/tooltip:translate-y-0">
                            <i class="fas fa-copy"></i> MÁSOLÁS
                        </p>
                    </div>
                </div>

                <!-- Aktivitás Doboz -->
                <div class="discord-bg rounded-xl p-4 mt-auto relative overflow-hidden z-10">
                    <p class="text-xs text-gray-400 uppercase tracking-widest mb-2 flex items-center gap-2">
                        <i class="fas fa-gamepad text-[#d42426]"></i> Jelenlegi Aktivitás
                    </p>
                    <div class="flex items-center gap-3 relative z-10">
                        <div id="game-activity-image" class="w-16 h-16 rounded-lg bg-cover bg-center shadow-lg border border-white/10 flex-shrink-0 bg-black"></div>
                        <div class="flex-1 min-w-0">
                            <p id="game-name" class="font-bold text-md text-[#a5f3fc] truncate">Csendes Éj...</p>
                            <p id="game-details" class="text-xs text-gray-300 truncate">Pihenés a kandalló előtt</p>
                            <p id="activity-time" class="text-xs text-[#146b3a] font-mono mt-1 font-bold bg-black/50 inline-block px-2 rounded">--:--</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Zenelejátszó -->
            <div class="glass-card p-6 pt-8 relative">
                <div class="absolute -bottom-2 -right-2 text-6xl text-[#146b3a]/40 rotate-12 pointer-events-none z-0">
                    <i class="fas fa-music"></i>
                </div>

                <h2 class="text-xl font-bold mb-4 border-b border-white/20 pb-2 flex items-center gap-2 text-[#a5f3fc] z-10 relative">
                    <i class="fas fa-bell text-[#f8b229]"></i> Karácsonyi Rádió
                </h2>

                <div class="flex items-center gap-4 mb-4 z-10 relative">
                    <!-- Forgó Bakelit -->
                    <div id="vinyl-record" class="w-20 h-20 rounded-full bg-black border-4 border-[#222] flex items-center justify-center shadow-xl relative vinyl-paused vinyl-spin">
                         <div class="w-8 h-8 rounded-full bg-[#d42426] border-2 border-white"></div>
                         <div class="absolute inset-0 rounded-full border border-white/10"></div>
                         <div class="absolute inset-2 rounded-full border border-white/10"></div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="font-bold text-[#f8b229] truncate font-christmas text-xl">Last Christmas</p>
                        <p class="text-xs text-gray-400">Wham!</p>
                    </div>
                </div>

                <div class="flex flex-col gap-3 z-10 relative">
                    <div class="w-full bg-black/50 h-2 rounded-full overflow-hidden border border-white/5">
                        <div id="music-progress-bar" class="h-full bg-gradient-to-r from-[#d42426] via-[#f8b229] to-[#146b3a] w-0 transition-all duration-500"></div>
                    </div>

                    <div class="flex items-center justify-between mt-1">
                        <div class="flex items-center gap-2 group/vol">
                            <i class="fas fa-volume-down text-xs text-gray-400"></i>
                            <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.3" class="w-24 h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-[#f8b229]">
                        </div>

                        <button id="play-pause-btn" class="w-12 h-12 rounded-full bg-gradient-to-br from-[#146b3a] to-[#0f3d22] hover:scale-110 border-2 border-[#f8b229] shadow-[0_0_15px_rgba(20,107,58,0.6)] flex items-center justify-center text-white transition-all">
                            <i class="fas fa-play ml-1"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <audio id="audio-element" loop crossorigin="anonymous">
        <source src="https://files.catbox.moe/u6jcrz.mp3" type="audio/mpeg">
    </audio>

    <!-- Visszaszámláló -->
    <div class="w-full max-w-3xl mx-auto mb-4 z-10 px-4">
        <div class="glass-card p-6 pt-8 text-center relative overflow-hidden">
             <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-[#d42426] via-[#f8b229] to-[#146b3a]"></div>
             
             <h3 class="text-2xl font-bold text-[#f8b229] mb-6 font-christmas tracking-widest drop-shadow-md relative z-10">
                <i class="fas fa-sleigh mr-2 text-white"></i> Még ennyi van a Karácsonyból
             </h3>
             
             <div class="grid grid-cols-4 gap-4 relative z-10">
                <div class="bg-black/50 p-2 rounded-lg border border-white/10"><span id="cnt-days" class="text-3xl font-bold text-[#d42426]">00</span><br><span class="text-xs uppercase text-gray-400">Nap</span></div>
                <div class="bg-black/50 p-2 rounded-lg border border-white/10"><span id="cnt-hours" class="text-3xl font-bold text-[#146b3a]">00</span><br><span class="text-xs uppercase text-gray-400">Óra</span></div>
                <div class="bg-black/50 p-2 rounded-lg border border-white/10"><span id="cnt-minutes" class="text-3xl font-bold text-[#f8b229]">00</span><br><span class="text-xs uppercase text-gray-400">Perc</span></div>
                <div class="bg-black/50 p-2 rounded-lg border border-white/10"><span id="cnt-seconds" class="text-3xl font-bold text-[#a5f3fc]">00</span><br><span class="text-xs uppercase text-gray-400">Mp</span></div>
             </div>
        </div>
    </div>

    <footer class="w-full max-w-4xl pb-28 md:pb-10 z-10 flex flex-col items-center">
        <div id="visitor-count-container" class="mt-8 text-center">
            <span class="text-[#f8b229] font-mono text-sm bg-black/60 px-6 py-2 rounded-full border border-[#f8b229]/30 shadow-lg">
                <i class="fas fa-users mr-2"></i> Manók a bázison: <span id="visitor-count" class="font-bold text-white">...</span>
            </span>
        </div>
    </footer>
    
    <!-- Toast Értesítés -->
    <div id="toast-notification">
        <i class="fas fa-gift text-[#f8b229] text-3xl animate-bounce"></i>
        <div class="text-left">
            <p class="font-bold text-[#f8b229] text-xs uppercase tracking-wider mb-0">Ajándék kicsomagolva!</p>
            <p id="toast-message" class="text-white font-mono text-lg font-bold tracking-wide drop-shadow-md"></p>
        </div>
    </div>

    <!-- Welcome Modal -->
    <div id="welcome-modal" class="fixed inset-0 z-[100] flex items-center justify-center bg-black/90 transition-opacity duration-500 backdrop-blur-sm">
        <div class="glass-card max-w-md w-full mx-4 p-8 text-center relative border-4 border-[#d42426]">
            <h2 class="text-4xl font-bold text-[#f8b229] mb-4 font-christmas relative z-20">
                Ho-Ho-Ho! <i class="fas fa-candy-cane text-[#d42426]"></i>
            </h2>
            <div class="space-y-4 text-gray-200 mb-8 text-sm relative z-20">
                <p>Üdvözöllek a Karácsonyi Bázison! Mielőtt belépnél:</p>
                <ul class="list-none space-y-2 text-[#a5f3fc]">
                    <li><i class="fas fa-snowflake mr-2"></i> DevTools használata tilos (a manók figyelnek!)</li>
                    <li><i class="fas fa-snowflake mr-2"></i> Jobb klikk letiltva (titkos recept)</li>
                </ul>
            </div>
            <button id="accept-rules-btn" class="w-full py-4 bg-gradient-to-r from-[#d42426] to-[#8a1c1d] hover:scale-105 text-white font-bold rounded-xl shadow-[0_0_20px_rgba(212,36,38,0.5)] transition-all border border-[#f8b229] relative z-20">
                <i class="fas fa-door-open mr-2"></i> Belépés a Házikóba
            </button>
        </div>
    </div>

    <script>
        // --- ZENELEJÁTSZÓ LOGIKA ---
        const audio = document.getElementById('audio-element');
        const playBtn = document.getElementById('play-pause-btn');
        const icon = playBtn.querySelector('i');
        const volumeSlider = document.getElementById('volume-slider');
        const progressBar = document.getElementById('music-progress-bar');
        const vinylRecord = document.getElementById('vinyl-record');
        
        let isPlaying = false;

        if(volumeSlider) {
            audio.volume = volumeSlider.value;
            volumeSlider.addEventListener('input', (e) => audio.volume = e.target.value);
        }

        if(progressBar) {
            audio.addEventListener('timeupdate', () => {
                if (audio.duration) {
                    const percent = (audio.currentTime / audio.duration) * 100;
                    progressBar.style.width = `${percent}%`;
                }
            });
        }

        playBtn.addEventListener('click', () => {
            if (isPlaying) {
                audio.pause();
                icon.classList.remove('fa-pause');
                icon.classList.add('fa-play');
                vinylRecord.classList.add('vinyl-paused');
            } else {
                audio.play().catch(e => console.log("Audio error:", e));
                icon.classList.remove('fa-play');
                icon.classList.add('fa-pause');
                vinylRecord.classList.remove('vinyl-paused');
            }
            isPlaying = !isPlaying;
        });

        // --- DISCORD STATUS ---
        const DISCORD_ID = '1095731086513930260';
        
        const discordStatusIndicator = document.getElementById('discord-status-indicator');
        const discordStatusText = document.getElementById('discord-status-text');
        const discordAvatar = document.getElementById('discord-avatar');
        const discordUsername = document.getElementById('discord-username');
        const discordDiscriminator = document.getElementById('discord-discriminator');
        const gameName = document.getElementById('game-name');
        const gameDetails = document.getElementById('game-details');
        const gameImage = document.getElementById('game-activity-image');
        const activityTime = document.getElementById('activity-time');

        let globalStartTime = null;
        let globalEndTime = null;
        let isSpotify = false;
        let realDiscordHandle = ""; 

        async function updateDiscordStatus() {
            try {
                const response = await fetch(`https://api.lanyard.rest/v1/users/${DISCORD_ID}`);
                const data = await response.json();
                
                if (!data.success) return;
                
                const user = data.data;
                const discord_user = user.discord_user;
                
                if (discord_user.discriminator === '0') {
                    realDiscordHandle = discord_user.username;
                } else {
                    realDiscordHandle = `${discord_user.username}#${discord_user.discriminator}`;
                }

                if(discordUsername) discordUsername.innerText = discord_user.global_name || discord_user.username;
                if(discordDiscriminator) discordDiscriminator.innerText = discord_user.discriminator === '0' ? '' : `#${discord_user.discriminator}`;
                
                if (discord_user.avatar && discordAvatar) {
                    discordAvatar.src = `https://cdn.discordapp.com/avatars/${DISCORD_ID}/${discord_user.avatar}.png`;
                }

                const statusColors = {
                    online: '#22c55e',
                    idle: '#facc15',
                    dnd: '#ef4444',
                    offline: '#6b7280'
                };
                
                let status = user.discord_status;
                if(status === 'dnd') status = 'Do Not Disturb';
                
                discordStatusText.innerText = status.charAt(0).toUpperCase() + status.slice(1);
                discordStatusIndicator.style.backgroundColor = statusColors[user.discord_status] || statusColors.offline;
                
                // Reset
                globalStartTime = null;
                globalEndTime = null;
                isSpotify = false;

                // Spotify / Game Logic
                if (user.listening_to_spotify) {
                    const spotify = user.spotify;
                    isSpotify = true;
                    gameName.innerText = spotify.artist;
                    gameDetails.innerText = spotify.song;
                    if (spotify.album_art_url) gameImage.style.backgroundImage = `url('${spotify.album_art_url}')`;
                    if (spotify.timestamps) {
                        globalStartTime = spotify.timestamps.start;
                        globalEndTime = spotify.timestamps.end;
                    }
                } else {
                    let activity = user.activities.find(a => a.type === 0) || user.activities.find(a => a.type === 2) || user.activities.find(a => a.type === 4);

                    if (activity) {
                        if (activity.type === 0 || activity.type === 1) {
                            gameName.innerText = activity.name;
                            gameDetails.innerText = activity.details || activity.state || "Playing";
                            if (activity.assets && activity.assets.large_image) {
                                let imageUrl = activity.assets.large_image;
                                if(imageUrl.startsWith("mp:external")) {
                                    imageUrl = imageUrl.replace(/mp:external\/([^\/]*)\/(https?)(:|\/)/, '$2:/');
                                } else if (!imageUrl.startsWith("http")) {
                                    imageUrl = `https://cdn.discordapp.com/app-assets/${activity.application_id}/${activity.assets.large_image}.png`;
                                }
                                gameImage.style.backgroundImage = `url('${imageUrl}')`;
                            } else {
                                gameImage.style.backgroundImage = `url('https://placehold.co/100x100/0f172a/a5f3fc?text=GAME')`;
                            }
                            if (activity.timestamps && activity.timestamps.start) {
                                globalStartTime = activity.timestamps.start;
                            }
                        } else if (activity.type === 4) {
                            gameName.innerText = "Status";
                            gameDetails.innerText = activity.state || "";
                            gameImage.style.backgroundImage = `url('https://placehold.co/100x100/0f172a/a5f3fc?text=...  ')`;
                        }
                    } else {
                        gameName.innerText = "Pihenés";
                        gameDetails.innerText = "Várja a csodát...";
                        gameImage.style.backgroundImage = `url('https://placehold.co/100x100/0f172a/a5f3fc?text=ZZZ')`;
                        activityTime.innerText = "";
                    }
                }

            } catch (error) {
                console.error("Lanyard Error:", error);
            }
        }

        // --- MÁSOLÁS (JAVÍTOTT) ---
        const discordInfoContainer = document.getElementById('discord-info-container');
        const toast = document.getElementById('toast-notification');
        const toastMessage = document.getElementById('toast-message');

        if (discordInfoContainer) {
            discordInfoContainer.addEventListener('click', () => {
                if (realDiscordHandle) {
                    const textArea = document.createElement("textarea");
                    textArea.value = realDiscordHandle;
                    textArea.style.position = "fixed";
                    textArea.style.left = "-9999px";
                    textArea.style.top = "0";
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    
                    try {
                        const successful = document.execCommand('copy');
                        if(successful) {
                            showToast(realDiscordHandle);
                        } else {
                            showToast("Hiba történt!"); 
                        }
                    } catch (err) {
                        console.error('Copy failed', err);
                    }
                    document.body.removeChild(textArea);
                }
            });
        }

        function showToast(handle) {
            toastMessage.innerText = handle;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // --- IDŐZÍTŐ SEGÉDFUNKCIÓK ---
        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const h = Math.floor(totalSeconds / 3600);
            const m = Math.floor((totalSeconds % 3600) / 60);
            const s = totalSeconds % 60;
            if (h > 0) return `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
            return `${m}:${s.toString().padStart(2, '0')}`;
        }

        function updateActivityTimer() {
            if (!activityTime) return;
            if (globalStartTime) {
                const now = Date.now();
                if (isSpotify && globalEndTime) {
                    const current = now - globalStartTime;
                    const total = globalEndTime - globalStartTime;
                    const safeCurrent = Math.min(Math.max(current, 0), total);
                    activityTime.innerText = `${formatTime(safeCurrent)} / ${formatTime(total)}`;
                } else {
                    const elapsed = now - globalStartTime;
                    activityTime.innerText = `${formatTime(elapsed)} eltelt idő`;
                }
            } else {
                activityTime.innerText = "";
            }
        }

        // --- VISSZASZÁMLÁLÓ (Szezon Vége - Dec 26. 23:59:59) ---
        function updateCountdown() {
            const now = new Date();
            const currentYear = now.getFullYear();
            
            // Cél: Karácsony vége, December 26. 23:59:59
            let xmasEnd = new Date(currentYear, 11, 26, 23, 59, 59); 
            
            // Ha a mostani idő már túl van ezen (pl. dec 27 van), akkor vége
            if (now > xmasEnd) {
                ['days','hours','minutes','seconds'].forEach(id => document.getElementById(`cnt-${id}`).innerText = "00");
                return;
            }

            const diff = xmasEnd - now;

            document.getElementById('cnt-days').innerText = Math.floor(diff / 1000 / 60 / 60 / 24).toString().padStart(2,'0');
            document.getElementById('cnt-hours').innerText = (Math.floor(diff / 1000 / 60 / 60) % 24).toString().padStart(2,'0');
            document.getElementById('cnt-minutes').innerText = (Math.floor(diff / 1000 / 60) % 60).toString().padStart(2,'0');
            document.getElementById('cnt-seconds').innerText = (Math.floor(diff / 1000) % 60).toString().padStart(2,'0');
        }

        // --- LÁTOGATÓ SZÁMLÁLÓ ---
        fetch(`https://api.counterapi.dev/v1/szaby-is-a-dev/latogatok/up`)
            .then(res => res.json())
            .then(data => document.getElementById('visitor-count').innerText = data.count)
            .catch(() => document.getElementById('visitor-count').innerText = "N/A");

        // --- INIT & ESEMÉNYEK ---
        updateDiscordStatus();
        setInterval(updateDiscordStatus, 5000);
        setInterval(updateActivityTimer, 1000);
        setInterval(updateCountdown, 1000);
        updateCountdown();

        const modal = document.getElementById('welcome-modal');
        const acceptBtn = document.getElementById('accept-rules-btn');

        document.addEventListener('contextmenu', event => event.preventDefault());
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) || (e.ctrlKey && e.key === 'u')) {
                e.preventDefault();
                return false;
            }
        });

        acceptBtn.addEventListener('click', () => {
            modal.style.opacity = '0';
            setTimeout(() => modal.style.display = 'none', 500);
            if (!isPlaying) {
                // Auto-play music attempt
                audio.play().then(() => {
                    vinylRecord.classList.remove('vinyl-paused');
                    icon.classList.remove('fa-play');
                    icon.classList.add('fa-pause');
                    isPlaying = true;
                }).catch(e => console.log("Autoplay blocked", e));
            }
        });

    </script>
</body>
</html>
